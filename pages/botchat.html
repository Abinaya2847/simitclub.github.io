<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="../css/botchat.css" rel="stylesheet" />
</head>

<body>
    <div id="bot"></div>
    <script src="https://cdn.botframework.com/botframework-webchat/latest/botchat.js"></script>
    <script src="https://cdn.botframework.com/botframework-webchat/latest/CognitiveServices.js"></script>
    <script>
        var speechOptions = {
            speechRecognizer: new CognitiveServices.SpeechRecognizer({ subscriptionKey: 'a0fc129873f441488defffa380d34d55' }),

            speechSynthesizer: new CognitiveServices.SpeechSynthesizer(
                {
                    subscriptionKey: 'a0fc129873f441488defffa380d34d55',
                    gender: CognitiveServices.SynthesisGender.Female,
                    voiceName: 'Microsoft Server Speech Text to Speech Voice (en-US, JessaRUS)'
                })
        }

        var user = guid();
        BotChat.App({
            directLine: { secret: '3h8VQ2panyw.cwA.7p4.QV97cGLXWebGc0cNtZzCM8X1_6u5AypYukmX7myAw_I' },
            user: { id: user, name: 'You' },
            bot: { id: 'website' },
            resize: 'detect',
            speechOptions: speechOptions
        }, document.getElementById("bot"));

        function guid() {
            function s4() {
                return Math.floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
            }
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                s4() + '-' + s4() + s4() + s4();
        }
    </script>
    <script type='text/javascript' src="https://www.botlibre.com/scripts/sdk.js"></script>
    <script type='text/javascript'>
        SDK.applicationId = "8084411693033336948";
        var sdk = new SDKConnection();
        var web = new WebAvatar();
        web.connection = sdk;
        web.avatar = "14071666";
        web.voice = "";
        web.voiceMod = "";
        web.width = "250";
        web.height = "300";
        web.createBox();
        web.addMessage("Welcome to my website", "", "", "");
        web.addMessage("Hi Smith", "", "", "");
        web.addMessage("Welcome", "", "", "");
        web.processMessages();
        startDictation();
        function startDictation() {

            if (window.hasOwnProperty('webkitSpeechRecognition')) {

                var recognition = new webkitSpeechRecognition();

                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.lang = "en-US";
                recognition.start();

                recognition.onresult = function (e) {
                    var foundText = e.results[0][0].transcript;
                    console.log(foundText);
                    if (foundText == "hello") {
                        web.addMessage("hi", "", "", "");
                    }
                    else if (foundText == "password") {
                        web.addMessage("password is not setup yet", "", "", "");
                    }
                    else {
                        web.addMessage("text not found", "", "", "");
                    }
                    web.processMessages();
                    recognition.stop();
                    startDictation();
                };

                recognition.onerror = function (e) {
                    console.log("found error", e);
                    recognition.stop();
                }

            }
        }

    </script>
</body>

</html>